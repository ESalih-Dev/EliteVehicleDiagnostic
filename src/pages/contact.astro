---
import Layout from '../layouts/Layout.astro'
import { ManufacturerField } from '@/components/contact/manufacturerField'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import '@/styles/globals.css'
import { Button } from '@/components/ui/button'
---

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const messageEle = document.getElementById('description')
    const counterEle = document.getElementById('counter')
    if (messageEle && counterEle) {
      const maxLength = messageEle.getAttribute('maxlength')

      counterEle.innerHTML = '0/' + maxLength

      messageEle.addEventListener('input', e => {
        const target = e.currentTarget as HTMLTextAreaElement
        const maxLength = target.getAttribute('maxLength')
        const currentLength = target.value.length
        counterEle.innerHTML = currentLength + '/' + maxLength
      })
    }
  })
</script>

<Layout title="Contact | EliteVehicleDiagnostic">
  <form
    action="/api/contact"
    method="POST"
    enctype="application/x-www-form-urlencoded"
    class="flex flex-col space-y-6 max-w-[600px] w-full mt-16 px-6 self-center">
    <div class="flex flex-col sm:flex-row sm:items-center whitespace-nowrap">
      <label class="mb-2 sm:mr-4 sm:mb-0">Full name</label>
      <Input name="fullName" required minLength={3} maxLength={100} placeholder="John Smith" />
    </div>
    <div class="flex space-y-4 sm:space-x-4 sm:space-y-0 flex-col sm:flex-row w-full">
      <div class="flex flex-col flex-grow-[2]">
        <label class="ml-1 mb-2">Email</label>
        <Input name="email" required type="email" placeholder="johnsmith@gmail.com" />
      </div>
      <div class="flex flex-col flex-grow-1">
        <label class="ml-1 mb-2">Phone <span class="text-zinc-500">(optional)</span></label>
        <Input name="phone" type="tel" pattern="[+]{0,1}[0-9]{11,14}" placeholder="07912345678" />
      </div>
    </div>
    <div class="flex space-y-4 sm:space-x-4 sm:space-y-0 flex-col sm:flex-row w-full">
      <div class="flex flex-col w-full">
        <label class="ml-1 mb-2">Car make</label>
        <ManufacturerField client:load />
      </div>
      <div class="flex flex-col w-full">
        <label class="ml-1 mb-2">Car model <span class="text-zinc-500">(optional)</span></label>
        <Input name="model" placeholder="e.g. 320d" />
      </div>
    </div>
    <div class="flex flex-col">
      <label class="ml-1 mb-2">Description</label>
      <Textarea
        id="description"
        name="description"
        minLength={20}
        maxLength={500}
        placeholder="Describe the problem here..."
      />
      <span id="counter" class="mt-1 text-zinc-500 text-end">0</span>
    </div>
    <Button type="submit">Submit</Button>
  </form>
</Layout>
